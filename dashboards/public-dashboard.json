{
  "dashboard": {
    "title": "CIRIS Public Dashboard",
    "description": "Public visibility into CIRIS agent telemetry",
    "panels": [
      {
        "id": "admin-link",
        "type": "text",
        "gridPos": {
          "x": 0,
          "y": 0,
          "w": 24,
          "h": 1
        },
        "options": {
          "content": "<div style='text-align: right; padding: 10px;'><a href='/admin/' style='color: #0066cc; text-decoration: none; font-size: 14px;'><i class='fa fa-lock'></i> Admin Portal</a></div>",
          "mode": "html"
        }
      },
      {
        "id": "agent-overview",
        "type": "stat",
        "title": "Active Agents",
        "description": "Number of agents with public visibility enabled",
        "gridPos": {
          "x": 0,
          "y": 1,
          "w": 6,
          "h": 4
        },
        "targets": [
          {
            "query": "count(ciris_agent_status{public_visible=\"true\"})"
          }
        ]
      },
      {
        "id": "cognitive-states",
        "type": "piechart",
        "title": "Cognitive State Distribution",
        "description": "Current cognitive states of visible agents",
        "gridPos": {
          "x": 6,
          "y": 1,
          "w": 6,
          "h": 4
        },
        "targets": [
          {
            "query": "ciris_agent_cognitive_state{public_visible=\"true\"}"
          }
        ]
      },
      {
        "id": "message-throughput",
        "type": "graph",
        "title": "Message Processing Rate",
        "description": "Messages processed per minute (PII redacted)",
        "gridPos": {
          "x": 12,
          "y": 1,
          "w": 12,
          "h": 4
        },
        "targets": [
          {
            "query": "rate(ciris_messagebus_messages_total{public_visible=\"true\"}[1m])"
          }
        ]
      },
      {
        "id": "resource-usage",
        "type": "graph",
        "title": "Resource Usage",
        "description": "LLM tokens and costs (aggregated)",
        "gridPos": {
          "x": 0,
          "y": 5,
          "w": 12,
          "h": 6
        },
        "targets": [
          {
            "query": "sum(ciris_agent_llm_tokens_total{public_visible=\"true\"})"
          },
          {
            "query": "sum(ciris_agent_llm_cost_cents_total{public_visible=\"true\"})"
          }
        ]
      },
      {
        "id": "health-status",
        "type": "table",
        "title": "Agent Health Status",
        "description": "Health status of publicly visible agents",
        "gridPos": {
          "x": 12,
          "y": 5,
          "w": 12,
          "h": 6
        },
        "targets": [
          {
            "query": "ciris_agent_health{public_visible=\"true\"}"
          }
        ],
        "options": {
          "columns": [
            {
              "field": "agent_id",
              "title": "Agent",
              "redact": true
            },
            {
              "field": "health",
              "title": "Status"
            },
            {
              "field": "cognitive_state",
              "title": "Cognitive State"
            },
            {
              "field": "uptime",
              "title": "Uptime"
            }
          ]
        }
      },
      {
        "id": "disclaimer",
        "type": "text",
        "gridPos": {
          "x": 0,
          "y": 11,
          "w": 24,
          "h": 2
        },
        "options": {
          "content": "<div style='background-color: #f0f8ff; border: 1px solid #0066cc; border-radius: 4px; padding: 10px; margin: 10px 0;'><strong>Privacy Notice:</strong> This dashboard only displays data from agents with public visibility enabled. All personally identifiable information (PII) is automatically redacted. Agent IDs are hashed for privacy. For full visibility, authorized users can access the <a href='/admin/'>Admin Portal</a>.</div>",
          "mode": "html"
        }
      }
    ],
    "refresh": "10s",
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "variables": [],
    "annotations": {
      "list": [
        {
          "datasource": "Loki",
          "enable": true,
          "expr": "{service=\"ciris_agent\", level=\"error\", public_visible=\"true\"}",
          "tagKeys": "level,service",
          "titleFormat": "Error Event",
          "textFormat": "{{message}}"
        }
      ]
    }
  }
}